<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduSync - Sistema de Gestión Académica</title>
    <link rel="stylesheet" href="../styles/base.css">
    <link rel="stylesheet" href="../styles/app.css">
    <link rel="stylesheet" href="../styles/components.css">
    <link rel="stylesheet" href="../styles/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Mobile Navigation Overlay -->
    <div id="navOverlay" class="nav-overlay">
        <div class="nav-content">
            <div class="nav-header">
                <h2>EduSync</h2>
                <button id="closeNav" class="close-nav">&times;</button>
            </div>
            <nav class="mobile-nav">
                <a href="#dashboard" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span data-translate="dashboard">Panel de Control</span>
                </a>
                <a href="#student-management" class="nav-item" data-section="student-management">
                    <i class="fas fa-users"></i>
                    <span data-translate="student_management">Gestión de Estudiantes</span>
                </a>
                <a href="#repository" class="nav-item" data-section="repository">
                    <i class="fas fa-archive"></i>
                    <span data-translate="repository">Repositorio</span>
                </a>
                <a href="#notifications" class="nav-item" data-section="notifications">
                    <i class="fas fa-bell"></i>
                    <span data-translate="notifications">Notificaciones</span>
                    <span class="notification-badge" id="notificationCount">0</span>
                </a>
                <a href="#reports" class="nav-item" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span data-translate="reports">Reportes</span>
                </a>
                <a href="#attendance" class="nav-item" data-section="attendance">
                    <i class="fas fa-calendar-check"></i>
                    <span data-translate="attendance">Asistencia</span>
                </a>
                
                <!-- Language Selector in Navigation -->
                <div class="nav-language-selector">
                    <div class="nav-language-label">
                        <i class="fas fa-globe"></i>
                        <span data-translate="language">Idioma</span>
                    </div>
                    <select id="languageSelect" class="nav-language-dropdown">
                        <option value="es">Español</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </nav>
        </div>
    </div>

    <!-- Desktop Navigation Header -->
    <header class="landing-header desktop-nav">
        <nav class="landing-nav">
            <div class="nav-brand">
                <i class="fas fa-graduation-cap"></i>
                <span>EduSync</span>
            </div>
            <div class="nav-menu" id="desktopNavMenu">
                <a href="#dashboard" class="nav-link" data-section="dashboard">
                    <span data-translate="dashboard">Panel de Control</span>
                </a>
                <a href="#student-management" class="nav-link" data-section="student-management">
                    <span data-translate="student_management">Gestión de Estudiantes</span>
                </a>
                <a href="#repository" class="nav-link" data-section="repository">
                    <span data-translate="repository">Repositorio</span>
                </a>
                <a href="#notifications" class="nav-link" data-section="notifications">
                    <span data-translate="notifications">Notificaciones</span>
                    <span class="notification-badge" id="desktopNotificationCount">0</span>
                </a>
                <a href="#reports" class="nav-link" data-section="reports">
                    <span data-translate="reports">Reportes</span>
                </a>
                <a href="#attendance" class="nav-link" data-section="attendance">
                    <span data-translate="attendance">Asistencia</span>
                </a>
                <div class="language-selector">
                    <select id="desktopLanguageSelect" class="language-dropdown">
                        <option value="es">Español</option>
                        <option value="en">English</option>
                    </select>
                </div>
                <div class="user-info">
                    <button id="desktopLogoutBtn" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            <div class="nav-toggle" id="desktopNavToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <div class="app-container">
        <!-- Mobile Header -->
        <header class="app-header mobile-header">
            <div class="header-left">
                <button id="menuToggle" class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>EduSync</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <span id="welcomeUser" data-translate="welcome_user">¡Bienvenido, Usuario!</span>
                    <button id="logoutBtn" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="dashboard-grid">
                    <!-- Quick Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="totalStudents">0</h3>
                                <p data-translate="total_students">Total Estudiantes</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="averageGrade">0%</h3>
                                <p data-translate="average_grade">Promedio de Calificaciones</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="attendanceRate">0%</h3>
                                <p data-translate="attendance_rate">Tasa de Asistencia</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="pendingNotifications">0</h3>
                                <p data-translate="notifications">Notificaciones</p>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content Area (Calendar + Next Classes) -->
                    <div class="dashboard-main-content">
                        <!-- Calendar Component -->
                        <div class="calendar-section">
                            <h2 data-translate="calendar">Calendario</h2>
                            <div class="calendar-container">
                                <div class="calendar-header">
                                    <button id="prevMonth" class="nav-btn">&lt;</button>
                                    <h3 id="currentMonth">Enero 2024</h3>
                                    <button id="nextMonth" class="nav-btn">&gt;</button>
                                </div>
                                <div class="calendar-grid" id="calendarGrid">
                                    <!-- Calendar will be generated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Next Classes Component -->
                        <div class="next-classes-section">
                            <h2 data-translate="upcoming_classes">Próximas Clases</h2>
                            <div class="classes-list" id="classesList">
                                <!-- Classes will be loaded dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Unified Student Management Section -->
            <section id="student-management" class="content-section">
                <div class="section-header">
                    <h2 data-translate="student_management">Gestión Integral de Estudiantes</h2>
                    <div class="section-actions">
                        <div class="filters">
                            <select id="unifiedCourseFilter" class="filter-select">
                                <option value="" data-translate="all_courses">Todos los Cursos</option>
                                <option value="9th" data-translate="9th_course">9º Curso</option>
                                <option value="10th" data-translate="10th_course">10º Curso</option>
                                <option value="11th" data-translate="11th_course">11º Curso</option>
                                <option value="12th" data-translate="12th_course">12º Curso</option>
                            </select>
                            <select id="unifiedSubjectFilter" class="filter-select">
                                <option value="" data-translate="all_subjects">Todas las Materias</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                        </div>
                        <div class="view-toggle">
                            <button id="unifiedGridViewBtn" class="view-btn active" data-view="grid">
                                <i class="fas fa-th"></i>
                            </button>
                            <button id="unifiedListViewBtn" class="view-btn" data-view="list">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <div class="action-buttons" id="globalActionButtons">
                            <button id="addStudentBtn" class="btn-primary students-only">
                                <i class="fas fa-user-plus"></i>
                                <span data-translate="add_student">Agregar Estudiante</span>
                            </button>
                            <button id="markAttendanceBtn" class="btn-secondary students-only">
                                <i class="fas fa-calendar-check"></i>
                                <span data-translate="mark_attendance">Marcar Asistencia</span>
                            </button>
                            <button id="createExamBtn" class="btn-primary exams-only" style="display: none;">
                                <i class="fas fa-plus"></i>
                                <span data-translate="create_exam">Crear Examen</span>
                            </button>
                            <button id="gradeStudentsBtn" class="btn-secondary exams-only" style="display: none;">
                                <i class="fas fa-graduation-cap"></i>
                                <span data-translate="grade_students">Calificar Estudiantes</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button id="studentsTab" class="tab-btn active" data-tab="students">
                        <i class="fas fa-users"></i>
                        <span data-translate="students">Estudiantes</span>
                    </button>
                    <button id="examsTab" class="tab-btn" data-tab="exams">
                        <i class="fas fa-file-alt"></i>
                        <span data-translate="exams">Exámenes</span>
                    </button>
                </div>

                <!-- Students Tab Content -->
                <div id="studentsTabContent" class="tab-content active">
                    <!-- Student Overview Cards -->
                    <div class="unified-student-cards" id="unifiedStudentCards">
                        <!-- Student cards with integrated grades and attendance will be loaded dynamically -->
                    </div>

                    <!-- Detailed List View -->
                    <div class="unified-student-list" id="unifiedStudentList" style="display: none;">
                        <!-- Detailed student information with grades and attendance will be loaded dynamically -->
                    </div>

                    <!-- Quick Stats for Selected Student -->
                    <div class="student-detail-panel" id="studentDetailPanel" style="display: none;">
                        <div class="panel-header">
                            <h3 id="selectedStudentName">Student Name</h3>
                            <button id="closeStudentDetail" class="btn-icon">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="panel-content">
                            <div class="student-stats">
                                <div class="stat-item">
                                    <span class="stat-label" data-translate="average_grade">Promedio:</span>
                                    <span class="stat-value" id="studentAverage">0%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label" data-translate="attendance_rate">Asistencia:</span>
                                    <span class="stat-value" id="studentAttendance">0%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label" data-translate="total_grades">Calificaciones:</span>
                                    <span class="stat-value" id="studentTotalGrades">0</span>
                                </div>
                            </div>
                            <div class="student-details">
                                <div class="detail-section">
                                    <h4 data-translate="recent_grades">Calificaciones Recientes</h4>
                                    <div id="studentRecentGrades" class="grades-list">
                                        <!-- Recent grades will be loaded here -->
                                    </div>
                                </div>
                                <div class="detail-section">
                                    <h4 data-translate="attendance_history">Historial de Asistencia</h4>
                                    <div id="studentAttendanceHistory" class="attendance-list">
                                        <!-- Attendance history will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Exams Tab Content -->
                <div id="examsTabContent" class="tab-content">
                    <div class="exams-container" id="examsContainer">
                        <!-- Exams will be loaded dynamically -->
                    </div>
                    <div class="exams-list" id="examsList" style="display: none;">
                        <!-- Exams list view will be loaded dynamically -->
                    </div>
                </div>
            </section>


            <!-- Repository Section -->
            <section id="repository" class="content-section">
                <div class="section-header">
                    <h2 data-translate="academic_repository">Repositorio Académico</h2>
                    <div class="section-actions">
                        <div class="view-toggle">
                            <button id="repositoryGridViewBtn" class="view-btn active" data-view="grid">
                                <i class="fas fa-th"></i>
                            </button>
                            <button id="repositoryListViewBtn" class="view-btn" data-view="list">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <button id="uploadFileBtn" class="btn-primary">
                            <i class="fas fa-upload"></i>
                            <span data-translate="upload_file">Subir Archivo</span>
                        </button>
                    </div>
                </div>
                <div class="repository-container" id="repositoryContainer">
                    <!-- Repository files will be loaded dynamically -->
                </div>
                <div class="repository-list" id="repositoryList" style="display: none;">
                    <!-- Repository list view will be loaded dynamically -->
                </div>
            </section>

            <!-- Notifications Section -->
            <section id="notifications" class="content-section">
                <div class="section-header">
                    <h2 data-translate="notifications">Notificaciones</h2>
                    <div class="section-actions">
                        <div class="view-toggle">
                            <button id="notificationsGridViewBtn" class="view-btn active" data-view="grid">
                                <i class="fas fa-th"></i>
                            </button>
                            <button id="notificationsListViewBtn" class="view-btn" data-view="list">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <button id="markAllReadBtn" class="btn-secondary">
                            <i class="fas fa-check-double"></i>
                            <span data-translate="mark_all_read">Marcar Todo como Leído</span>
                        </button>
                    </div>
                </div>
                <div class="notifications-container" id="notificationsContainer">
                    <!-- Notifications will be loaded dynamically -->
                </div>
                <div class="notifications-list" id="notificationsList" style="display: none;">
                    <!-- Notifications list view will be loaded dynamically -->
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="content-section">
                <div class="section-header">
                    <h2 data-translate="reports_analytics">Reportes y Análisis</h2>
                </div>
                <div class="reports-container" id="reportsContainer">
                    <!-- Reports will be loaded dynamically -->
                </div>
            </section>

            <!-- Attendance Section -->
            <section id="attendance" class="content-section">
                <div class="section-header">
                    <h2 data-translate="attendance_management">Gestión de Asistencia</h2>
                    <div class="section-actions">
                        <div class="filters">
                            <select id="attendanceCourseFilter" class="filter-select">
                                <option value="" data-translate="all_courses">Todos los Cursos</option>
                                <option value="9th" data-translate="9th_course">9º Curso</option>
                                <option value="10th" data-translate="10th_course">10º Curso</option>
                                <option value="11th" data-translate="11th_course">11º Curso</option>
                                <option value="12th" data-translate="12th_course">12º Curso</option>
                            </select>
                            <select id="attendanceSubjectFilter" class="filter-select">
                                <option value="" data-translate="all_subjects">Todas las Materias</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                        </div>
                        <button id="markAttendanceBtn" class="btn-primary">
                            <i class="fas fa-calendar-check"></i>
                            <span data-translate="mark_attendance">Marcar Asistencia</span>
                        </button>
                    </div>
                </div>
                
                <div class="attendance-view" id="attendanceView" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-translate="attendance_form">Formulario de Asistencia</h3>
                        </div>
                        <div class="card-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="attendanceDate" data-translate="date">Fecha: *</label>
                                    <input type="date" id="attendanceDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="attendanceCourseSelect" data-translate="course">Curso: *</label>
                                    <select id="attendanceCourseSelect" required>
                                        <option value="" data-translate="select_course">- Seleccionar -</option>
                                        <option value="9th" data-translate="9th_course">9º Curso</option>
                                        <option value="10th" data-translate="10th_course">10º Curso</option>
                                        <option value="11th" data-translate="11th_course">11º Curso</option>
                                        <option value="12th" data-translate="12th_course">12º Curso</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="attendanceSubjectSelect" data-translate="subject">Materia: *</label>
                                    <select id="attendanceSubjectSelect" required disabled>
                                        <option value="" data-translate="select_subject">- Seleccionar -</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="attendanceNotes" data-translate="observations">Observaciones:</label>
                                <textarea id="attendanceNotes" placeholder="Agregar observaciones sobre la clase..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" data-translate="students_attendance">Alumnos: Asistencia</h3>
                        </div>
                        <div class="card-content">
                            <div class="table-responsive">
                                <table class="data-table" id="attendanceTable">
                                    <thead>
                                        <tr>
                                            <th data-translate="student_id">ID Estudiante</th>
                                            <th data-translate="lastname_firstname">Apellido y nombre</th>
                                            <th class="status-column" data-translate="present">P</th>
                                            <th class="status-column" data-translate="absent">A</th>
                                            <th data-translate="absences">Faltas</th>
                                            <th data-translate="status">Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody id="attendanceTableBody">
                                        <!-- Students will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancelAttendanceBtn" data-translate="cancel">Cancelar</button>
                        <button type="button" class="btn-primary" id="saveAttendanceBtn" data-translate="save_attendance">Guardar Asistencia</button>
                    </div>
                </div>

                <div class="attendance-list" id="attendanceList">
                    <!-- Attendance records will be loaded here -->
                </div>
            </section>

        </main>
    </div>

    <!-- Modals -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-translate="add_edit_student">Agregar/Editar Estudiante</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="studentForm" class="modal-form">
                <div class="form-group">
                    <label for="studentFirstName" data-translate="first_name">Nombre</label>
                    <input type="text" id="studentFirstName" required>
                </div>
                <div class="form-group">
                    <label for="studentLastName" data-translate="last_name">Apellido</label>
                    <input type="text" id="studentLastName" required>
                </div>
                <div class="form-group">
                    <label for="studentEmail" data-translate="email">Correo Electrónico</label>
                    <input type="email" id="studentEmail" required>
                </div>
                <div class="form-group">
                    <label for="studentCourse" data-translate="course">Curso</label>
                    <select id="studentCourse" required>
                        <option value="9th" data-translate="9th_course">9º Curso</option>
                        <option value="10th" data-translate="10th_course">10º Curso</option>
                        <option value="11th" data-translate="11th_course">11º Curso</option>
                        <option value="12th" data-translate="12th_course">12º Curso</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary close-modal" data-translate="cancel">Cancelar</button>
                    <button type="submit" class="btn-primary" data-translate="save_student">Guardar Estudiante</button>
                </div>
            </form>
        </div>
    </div>

    <div id="gradeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-translate="add_grade">Agregar Calificación</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="gradeForm" class="modal-form">
                <div class="form-group">
                    <label for="gradeStudent" data-translate="student">Estudiante</label>
                    <select id="gradeStudent" required>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="gradeSubject" data-translate="subject">Materia</label>
                    <select id="gradeSubject" required>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="gradeValue" data-translate="grade_value">Calificación (0-100)</label>
                    <input type="number" id="gradeValue" min="0" max="100" required>
                </div>
                <div class="form-group">
                    <label for="gradeType" data-translate="type">Tipo</label>
                    <select id="gradeType" required>
                        <option value="exam" data-translate="exam">Examen</option>
                        <option value="homework" data-translate="homework">Tarea</option>
                        <option value="lab" data-translate="lab">Laboratorio</option>
                        <option value="project" data-translate="project">Proyecto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="gradeDescription" data-translate="description">Descripción</label>
                    <input type="text" id="gradeDescription">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary close-modal" data-translate="cancel">Cancelar</button>
                    <button type="submit" class="btn-primary" data-translate="save_grade">Guardar Calificación</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Script Modules -->
    <script src="../scripts/translations.js"></script>
    <script src="../scripts/utils.js"></script>
    <script src="../scripts/navigation.js"></script>
    <script src="../scripts/auth.js"></script>
    <script src="../scripts/dashboard.js"></script>
    <script src="../scripts/students.js"></script>
    <script src="../scripts/grades.js"></script>
    <script src="../scripts/attendance.js"></script>
    <script src="../scripts/unified-student-management.js"></script>
    <script src="../scripts/exams.js"></script>
    <script src="../scripts/repository.js"></script>
    <script src="../scripts/notifications.js"></script>
    <script src="../scripts/reports.js"></script>
    <script src="../scripts/main.js"></script>
</body>
</html>
